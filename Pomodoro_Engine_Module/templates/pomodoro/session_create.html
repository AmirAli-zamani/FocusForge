{% extends "pomodoro/base.html" %}

{% block title %}Start Pomodoro Session{% endblock %}

{% block content %}
<h2>Start a Pomodoro Session</h2>

<form method="POST">
    {% csrf_token %}
    
    <!-- Task -->
    <div class="form-group">
        <label for="{{ form.task.id_for_label }}">Task:</label>
        {{ form.task }}
        {% if form.task.errors %}
            <div class="error">{{ form.task.errors }}</div>
        {% endif %}
    </div>

    <!-- Start Time -->
    <div class="form-group">
        <label for="{{ form.start_time.id_for_label }}">Start Time:</label>
        {{ form.start_time }}
        {% if form.start_time.errors %}
            <div class="error">{{ form.start_time.errors }}</div>
        {% endif %}
    </div>

    <!-- End Time -->
    <div class="form-group">
        <label for="{{ form.end_time.id_for_label }}">End Time:</label>
        {{ form.end_time }}
        {% if form.end_time.errors %}
            <div class="error">{{ form.end_time.errors }}</div>
        {% endif %}
    </div>

    <!-- Duration -->
    <div class="form-group">
        <label for="{{ form.duration_minutes.id_for_label }}">Duration (minutes):</label>
        {{ form.duration_minutes }}
        {% if form.duration_minutes.errors %}
            <div class="error">{{ form.duration_minutes.errors }}</div>
        {% endif %}
    </div>

    <button class="btn">Start</button>
</form>

<p class="back-link">
    <a href="{% url 'pomodoro_engine_module:session_list' %}">← Back to sessions</a>
</p>

<!-- ساعت زنده -->
<div class="live-clock" id="liveClock"></div>
<div class="mini-calendar" id="miniCalendar"></div>

<script>
    function updateClock() {
        const now = new Date();
        document.getElementById("liveClock").innerText =
            now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });

        document.getElementById("miniCalendar").innerText =
            now.toLocaleDateString("en-US", { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    }
    setInterval(updateClock, 1000);
    updateClock();

    // پر کردن پیش‌فرض فرم
    window.onload = () => {
        const now = new Date();
        const startInput = document.getElementById("id_start_time");
        const endInput = document.getElementById("id_end_time");
        const durationInput = document.getElementById("id_duration_minutes");

        if (startInput) {
            startInput.value = now.toISOString().slice(0,16);  // YYYY-MM-DDTHH:MM
        }

        if (endInput) {
            const end = new Date(now.getTime() + 25*60000);
            endInput.value = end.toISOString().slice(0,16);
        }

        if (durationInput) {
            durationInput.value = 25;
        }
    };
</script>

{% endblock %}
