    {% load static %}

    <!DOCTYPE html>
    <html lang="fa">
    <head>
        <meta charset="UTF-8">
        <title>{% if form.instance.pk %}ویرایش تسک{% else %}افزودن تسک{% endif %}</title>
        <link rel="stylesheet" href="{% static 'tasks/task_style.css' %}">
    </head>
    <body>
    <div class="container">
        <h2>{% if form.instance.pk %}ویرایش تسک{% else %}افزودن تسک جدید{% endif %}</h2>

        {% if form.errors %}
            <ul class="form-errors">
                {% for field in form %}
                    {% for error in field.errors %}
                        <li>{{ field.label }}: {{ error }}</li>
                    {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        <form method="POST" novalidate>
            {% csrf_token %}
            {% for field in form %}
                <p>
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.help_text %}
                        <small style="color:#ccc;">{{ field.help_text }}</small>
                    {% endif %}
                </p>
            {% endfor %}

            <!-- تایمر شمارش معکوس برای deadline -->
            {% if form.instance.deadline %}
            <p>
                <strong>زمان باقی‌مانده تا مهلت:</strong>
                <span id="deadline-timer" style="font-weight:bold;"></span>
            </p>
            {% endif %}

            <button type="submit" class="btn">
                {% if form.instance.pk %}ویرایش{% else %}افزودن{% endif %}
            </button>
        </form>

        <p style="margin-top:15px;">
            <a href="{% url 'task_management_module:task_list' %}">بازگشت به لیست تسک‌ها</a>
        </p>
    </div>

    {% if form.instance.deadline %}
    <script>
        const deadline = new Date("{{ form.instance.deadline|date:'Y-m-d\\TH:i' }}");
        const timerEl = document.getElementById('deadline-timer');

        function updateCountdown(){
            const now = new Date();
            const diff = deadline - now;
            if(diff <= 0){
                timerEl.innerText = "زمان تمام شد!";
                clearInterval(interval);
            } else {
                const hours = Math.floor(diff/1000/60/60);
                const minutes = Math.floor((diff/1000/60)%60);
                const seconds = Math.floor((diff/1000)%60);
                timerEl.innerText = `${hours}h ${minutes}m ${seconds}s`;
            }
        }

        const interval = setInterval(updateCountdown, 1000);
        updateCountdown();
    </script>
    {% endif %}

    </body>
    </html>
